:root{
  --bg:#f5f5f5;--fg:#111;--accent:#e33;--muted:#999;--line:#cfcfcf;
}
*{box-sizing:border-box}
html,body{height:100%;background:var(--bg);color:var(--fg);font-family:ui-sans-serif,Segoe UI,system-ui,"PingFang SC",sans-serif}
#app{display:grid;grid-template-columns:280px 1fr 360px;grid-template-rows:100vh}
.sidebar{border-right:1.5px solid var(--line);padding:12px;background:#fafafa}
.brand{font-weight:700;letter-spacing:2px;margin-bottom:12px}
.session-title{margin:8px 0;font-weight:600}
.canvas-tree{list-style:none;padding-left:0;margin:0;border-top:1px solid var(--line)}
.canvas-tree li{padding:8px 6px;cursor:pointer;border-bottom:1px solid var(--line)}
.canvas-tree li.active{background:#fff;box-shadow:inset 0 0 0 1.5px var(--accent)}
.canvas-tree li::before{content:"â–£";margin-right:6px;color:#444}

.new-session{margin:6px 0 10px 0;border:1px solid var(--line);background:#fff;border-radius:8px;padding:6px 10px;cursor:pointer;width:100%}
.new-session:hover{border-color:#1890ff}
.sessions-list{list-style:none;margin:0 0 10px 0;padding:0;border-top:1px solid var(--line)}
.sessions-list li{padding:6px 8px;border-bottom:1px solid var(--line);cursor:pointer;display:flex;justify-content:space-between;align-items:center}
.sessions-list li.active{background:#fff;box-shadow:inset 0 0 0 1.5px #1890ff}

.canvas-area{position:relative;background:#fff;transition:opacity .2s ease, transform .2s ease}
.breadcrumb{height:36px;display:flex;align-items:center;padding:0 12px;border-bottom:1.5px solid var(--line);letter-spacing:.5px}
.graph{width:100%;height:calc(100% - 36px);background:repeating-linear-gradient(0deg,#f9f9f9,#f9f9f9 20px,#f2f2f2 20px,#f2f2f2 40px)}
.canvas-controls{position:absolute;top:40px;left:12px;z-index:5;display:flex;gap:8px}
.canvas-area.dim .graph{filter:brightness(.6)}
.back-btn{border:1px solid var(--line);background:#fff;border-radius:8px;padding:6px 10px;cursor:pointer}
.back-btn:hover{border-color:var(--accent)}
.overlay-node{position:absolute;top:80px;left:12px;z-index:4;background:#fff;border:1px solid var(--line);border-radius:8px;padding:8px 10px;min-width:160px;box-shadow:0 6px 18px rgba(0,0,0,.06)}
.overlay-node.hidden{display:none}
.hidden{display:none}
.node{stroke:#222;stroke-width:1.5px;fill:#fefefe;filter:drop-shadow(0 1px 0 #ddd)}
.selected{stroke:#1890ff !important;stroke-width:2px}
.node.important{stroke:var(--accent)}
.edge{stroke:#333;stroke-width:1.2px;marker-end:url(#arrow)
}
.selection-rect{fill:rgba(227,51,51,0.08);stroke:var(--accent);stroke-dasharray:4 3}
.pixel-badge{fill:#e33}
.handle{fill:#1890ff;stroke:#fff;stroke-width:1px}

@keyframes errorBlink{
  0%,100%{stroke:#e33;stroke-width:2.5px}
  50%{stroke:#ff0000;stroke-width:3.5px}
}
.error-flash{animation:errorBlink 1s ease-in-out}

.tooltip{position:absolute;max-width:280px;background:#fff;border:1px solid var(--line);border-radius:8px;padding:8px 10px;box-shadow:0 6px 18px rgba(0,0,0,.08);opacity:0;transition:opacity .12s ease, transform .12s ease;transform:translateY(-4px);z-index:6}
.tooltip.show{opacity:1;transform:translateY(0)}
.edge-hit{stroke-opacity:0;pointer-events:stroke;stroke-width:12}

.context-menu{position:absolute;background:#fff;border:1px solid var(--line);box-shadow:0 6px 18px rgba(0,0,0,.08);padding:6px;border-radius:8px;display:flex;gap:6px}
.context-menu.hidden{display:none}
.context-menu button{border:1px solid var(--line);background:#fafafa;padding:6px 10px;border-radius:6px;cursor:pointer}
.context-menu button:hover{border-color:var(--accent)}

.chat{border-left:1.5px solid var(--line);background:#fafafa;display:flex;flex-direction:column}
.chat-header{height:36px;display:flex;align-items:center;padding:0 12px;border-bottom:1.5px solid var(--line);font-weight:600}
.messages{flex:1;overflow:auto;padding:12px;display:flex;flex-direction:column;gap:10px}
.right-tree{max-height:160px;overflow:auto;border-bottom:1.5px solid var(--line);padding:8px 12px;background:#fff}
.right-tree ul{list-style:none;margin:0;padding:0}
.right-tree li{padding:4px 2px;border-bottom:1px dashed #eee}
.right-tree .title{font-weight:600;margin-bottom:4px}
.msg{background:#fff;border:1px solid var(--line);border-radius:8px;padding:10px}
.msg.user{box-shadow:inset 0 0 0 1.5px var(--accent)}
.composer{display:flex;gap:8px;padding:8px;border-top:1.5px solid var(--line)}
.composer input{flex:1;border:1px solid var(--line);border-radius:8px;padding:8px}
.composer button{border:1px solid var(--line);border-radius:8px;padding:8px 12px;background:#fff;cursor:pointer}
.composer button:hover{border-color:var(--accent)}
.canvas-overlay{position:absolute;left:0;top:36px;width:100%;height:calc(100% - 36px);background:rgba(0,0,0,.0);opacity:0;pointer-events:none;transition:opacity .35s ease, background .35s ease;z-index:7}
.canvas-overlay.show{background:rgba(0,0,0,.35);opacity:1;pointer-events:auto}
.tree-panel{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:#fff;border:1px solid var(--line);border-radius:10px;box-shadow:0 12px 28px rgba(0,0,0,.18);padding:14px 18px;min-width:360px;max-width:680px;max-height:70%;overflow:auto}
.tree-panel .title{font-weight:700;margin-bottom:8px}
.tree{list-style:none;margin:0;padding:0 0 0 12px}
.tree li{position:relative;padding:6px 8px 6px 16px;border-left:1px solid #e5e5e5}
.tree li::before{content:"";position:absolute;left:0;top:14px;width:10px;height:1px;background:#e5e5e5}
.tree .node{display:inline-flex;align-items:center;gap:8px;cursor:pointer;padding:6px 10px;border:1px solid var(--line);border-radius:8px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.08);transition:transform .12s ease,border-color .12s ease}
.tree .node .icon{width:12px;height:12px;background:#1890ff;border-radius:2px;box-shadow:0 0 0 2px rgba(24,144,255,.2)}
.tree .node:hover{border-color:#1890ff;transform:translateY(-1px)}
.tree .node:active{transform:translateY(0)}
.tree .node.selected{outline:2px solid #1890ff;border-radius:6px}
.tree .node.disabled{opacity:.5;cursor:not-allowed}
.thumb{width:120px;height:80px;border:1px solid var(--line);border-radius:8px;overflow:hidden;background:#fafafa;box-shadow:0 2px 8px rgba(0,0,0,.08);transition:opacity .2s ease,transform .12s ease}
.thumb.loading{opacity:.6}
.thumb:hover{transform:translateY(-1px)}
@media (max-width: 900px){ .tree-panel{min-width:280px;max-width:90%} .thumb{width:96px;height:64px} }
.cancel-hint{position:absolute;top:10px;right:10px;background:rgba(255,255,255,.9);border:1px solid var(--line);border-radius:6px;padding:4px 8px;font-size:12px;color:#555}
